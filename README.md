# configen

[![License](https://img.shields.io/github/license/kukymbr/configen.svg)](https://github.com/kukymbr/configen/blob/main/LICENSE)
[![Release](https://img.shields.io/github/release/kukymbr/configen.svg)](https://github.com/kukymbr/configen/releases/latest)
[![GoDoc](https://godoc.org/github.com/kukymbr/configen?status.svg)](https://godoc.org/github.com/kukymbr/configen)
[![GoReport](https://goreportcard.com/badge/github.com/kukymbr/configen)](https://goreportcard.com/report/github.com/kukymbr/configen)

The `configen` is a config files generator for the [Golang](https://go.dev), converting this:

```go
package readme

// Config is an example application config.
type Config struct {
	// App is an application common settings.
	App AppConfig `envPrefix:"APP_" yaml:"app"`

	// Logger is a logging setup values.
	Logger LoggerConfig `envPrefix:"LOG_" yaml:"logger"`

	// API is an API server configuration.
	API APIConfig `envPrefix:"API_" yaml:"api"`
}

type AppConfig struct {
	Env       string `env:"ENV" envDefault:"development" yaml:"env"`
	Namespace string `env:"NAMESPACE" envDefault:"unknown" yaml:"namespace"`
	Domain    string `env:"DOMAIN" yaml:"domain"`
}

type LoggerConfig struct {
	Level string `env:"LEVEL" envDefault:"debug" yaml:"level"`
}

type APIConfig struct {
	Host string `env:"HOST" envDefault:"0.0.0.0" yaml:"host"`
	Port int    `env:"PORT" envDefault:"8080" yaml:"port"`
}
```

into this:

```yaml
# config is an example application config.

# This file is generated by github.com/kukymbr/configen; DO NOT EDIT.
# Source struct: config

# App is an application common settings.
app:
  env: development
  namespace: unknown
  domain: ""
# Logger is a logging setup values.
logger:
  level: debug
# API is an API server configuration.
api:
  host: 0.0.0.0
  port: 8080
```

and this:

```dotenv
# config is an example application config.

# This file is generated by github.com/kukymbr/configen; DO NOT EDIT.
# Source struct: config

APP_ENV=development
APP_NAMESPACE=unknown
APP_DOMAIN=

LOG_LEVEL=debug

API_HOST=0.0.0.0
API_PORT=8080
```

Also, the `configen` is able to generate a new go struct with read-only getters of the config value.

<details>
  <summary>See the example of generated struct</summary>

```golang
// Package readme contains configuration read-only provider.
//
// Code generated by github.com/kukymbr/configen; DO NOT EDIT.
// Generator version: unknown (revision unknown, built at 2025-10-04 00:00:00)
package readme

import ()

type APIConfig struct {
	host string
	port int

	origin any
}

func (c APIConfig) Host() string {
	return c.host
}

func (c APIConfig) Port() int {
	return c.port
}

// NewAPIConfig is a constructor converting apiConfig into the APIConfig.
func NewAPIConfig(dto apiConfig) APIConfig {
	return APIConfig{
		host: dto.Host,
		port: dto.Port,

		origin: dto,
	}
}

type AppConfig struct {
	env       string
	namespace string
	domain    string

	origin any
}

func (c AppConfig) Env() string {
	return c.env
}

func (c AppConfig) Namespace() string {
	return c.namespace
}

func (c AppConfig) Domain() string {
	return c.domain
}

// NewAppConfig is a constructor converting appConfig into the AppConfig.
func NewAppConfig(dto appConfig) AppConfig {
	return AppConfig{
		env:       dto.Env,
		namespace: dto.Namespace,
		domain:    dto.Domain,

		origin: dto,
	}
}

type Config struct {
	app    AppConfig
	logger LoggerConfig
	api    APIConfig

	origin any
}

// App is an application common settings.
func (c Config) App() AppConfig {
	return c.app
}

// Logger is a logging setup values.
func (c Config) Logger() LoggerConfig {
	return c.logger
}

// API is an API server configuration.
func (c Config) API() APIConfig {
	return c.api
}

// NewConfig is a constructor converting config into the Config.
func NewConfig(dto config) Config {
	return Config{
		app:    NewAppConfig(dto.App),
		logger: NewLoggerConfig(dto.Logger),
		api:    NewAPIConfig(dto.API),

		origin: dto,
	}
}

type LoggerConfig struct {
	level string

	origin any
}

func (c LoggerConfig) Level() string {
	return c.level
}

// NewLoggerConfig is a constructor converting loggerConfig into the LoggerConfig.
func NewLoggerConfig(dto loggerConfig) LoggerConfig {
	return LoggerConfig{
		level: dto.Level,

		origin: dto,
	}
}
```

</details>

## Why?

1. To simplify the creation of config files, obviously;
2. and to easily keep up-to-date an example config files when config structure has changed;
3. to hide config values behind the read-only struct.

## Installation

The go 1.24 is a minimal requirement for the `configen`.

The `go tool` is a preferred way to install:

```shell
go get -tool github.com/kukymbr/configen/cmd/configen
```

## Usage

1. Create the structure you want to generate files from, e.g. `Config`;
2. set the tags, see the available tags in the table below;
3. add the `//go:generate` directive (run `go tool configen --help` for available flags):
   ```go
    package config  

   //go:generate go tool configen --struct=Config --yaml=true --env=true
   ```
4. run the `go generate` command:
   ```shell
   go generate ./...
   ```
5. see the generated files.

### Available struct tags

| Tag          | Value                                                                               |
|--------------|-------------------------------------------------------------------------------------|
| `yaml`       | key for the value in YAML file, or `-` to skip                                      |
| `env`        | key for the value in dotenv file, fields without this tag are not added to env file |
| `default`    | default value to write to config files, prioritized for YAML                        |
| `envDefault` | default value to write to config files, prioritized for env                         |
| `example`    | default value to write to config files, to use with swaggo for example              |

See the [example](example) directory for usage and generated code example.

### Command arguments to generate things

| Argument                   | Required | Value                                                                     |
|----------------------------|----------|---------------------------------------------------------------------------|
| `--struct=<StrcutName>`    | âœ…        | Name of the struct to generate config from                                |
| `--source=<dir>`           |          | Directory of the source go files (default ".")                            |
| `--yaml=<filepath/true>`   |          | Path to YAML config file, set 'true' to enable with default path          |
| `--yaml-tag=<tag>`         |          | Tag name for a YAML field names (default "yaml")                          |
| `--env=<filepath/true>`    |          | Path to dotenv config file, set 'true' to enable with default path        |
| `--env-tag=<tag>`          |          | Tag name for a dotenv field names (default "env")                         |
| `--go=<filepath/true>`     |          | Path to Golang config getter file, set 'true' to enable with default path |
| `--go-pkg=<package>`       |          | Target package name (default is equal to source package)                  |
| `--go-struct=<StructName>` |          | Target struct name (default is exported variant of incoming struct name)  |

The `configen --help` output:

```text
Usage:
  configen [flags]

Flags:
      --env string         Path to dotenv config file, set 'true' to enable with default path
      --env-tag string     Tag name for a dotenv field names (default "env")
      --go string          Path to Golang config getter file, set 'true' to enable with default path
      --go-pkg string      Target package name
      --go-struct string   Target struct name (default is exported variant of incoming struct name)
  -h, --help               help for configen
  -s, --silent             Silent mode
      --source string      Directory of the source go files (default ".")
      --struct string      Name of the struct to generate config from
  -v, --version            version for configen
      --yaml string        Path to YAML config file, set 'true' to enable with default path
      --yaml-tag string    Tag name for a YAML field names (default "yaml")
```

## Contributing

Please refer the [CONTRIBUTING.md](CONTRIBUTING.md) doc.

## TODO

- Add empty value check in go generator (for basic types), for example:
  ```golang
  func NewAppConfig(dto appConfig) AppConfig {
    if dto.env == "" {
        dto.env = "development"
    }
   
    return AppConfig{
        env: dto.Env,
    }
  }
  ```
- Make option to include/exclude origin in generated structs.

## License

[MIT](LICENSE).